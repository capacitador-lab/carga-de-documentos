<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dashboard de Capacitaciones</title>
  <style>
    body, html {
      margin: 0;
      padding: 0;
      width: 100%;
      height: 100%;
      overflow: hidden;
      font-family: Arial, sans-serif;
      background: #f5f5f5;
    }
    iframe {
      border: none;
      width: 100%;
      height: 100%;
    }
    #cargando {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      text-align: center;
      color: #333;
    }
    .spinner {
      border: 4px solid rgba(0, 0, 0, 0.1);
      border-radius: 50%;
      border-top: 4px solid #3498db;
      width: 40px;
      height: 40px;
      animation: spin 1s linear infinite;
      margin: 0 auto 20px;
    }
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    .error {
      color: #e74c3c;
      padding: 20px;
      background: white;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      max-width: 400px;
      margin: 0 auto;
    }
    .btn-reintentar {
      background: #3498db;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 4px;
      cursor: pointer;
      margin-top: 10px;
      font-size: 14px;
    }
  </style>
</head>
<body>

  <div id="contenedor">
    <div id="cargando">
      <div class="spinner"></div>
      <p>Cargando aplicación de documentos...</p>
    </div>
  </div>

  <iframe 
    id="mi-dashboard"
    title="Sistema de Documentos de Empleados"
    style="display: none;">
  </iframe>

  <script>
    // Tu URL codificada en Base64 (URL: https://script.google.com/macros/s/AKfycbzwG6m_uwI9fy-ARBmdwc4iOD4SAun9u2dfQ9iThbupFj9rVyl26o0i9ccv9RKxhmxh/exec)
    var codigoSecreto = "aHR0cHM6Ly9zY3JpcHQuZ29vZ2xlLmNvbS9tYWNyb3Mvcy9BS2Z5Y2J6d0c2bV91d0k5ZnktQVJCbWR3YzRpT0Q0U0F1bjl1MmRmUTlpVGhidXBGajlyVnlsMjZvMGk5Y2N2OVJLeGhteCgvZXhlYw==";

    // Función para decodificar Base64 de manera robusta
    function decodeBase64URL(base64) {
      try {
        // Eliminar cualquier espacio o salto de línea
        base64 = base64.replace(/\s/g, '');
        
        // Decodificar
        const decoded = atob(base64);
        console.log("URL decodificada:", decoded);
        return decoded;
      } catch (error) {
        console.error("Error al decodificar Base64:", error);
        return null;
      }
    }

    // Función para cargar el iframe
    function cargarDashboard() {
      var cargandoDiv = document.getElementById('cargando');
      var iframe = document.getElementById('mi-dashboard');
      var contenedor = document.getElementById('contenedor');
      
      // Decodificar la URL
      var urlReal = decodeBase64URL(codigoSecreto);
      
      if (!urlReal) {
        mostrarError("Error al procesar la URL de la aplicación.");
        return;
      }
      
      // Verificar que sea una URL válida
      if (!urlReal.startsWith('http')) {
        mostrarError("URL inválida. Contacte al administrador.");
        return;
      }
      
      // Configurar eventos del iframe
      iframe.onload = function() {
        cargandoDiv.style.display = 'none';
        iframe.style.display = 'block';
        console.log("Dashboard cargado exitosamente");
      };
      
      iframe.onerror = function() {
        mostrarError("No se pudo cargar la aplicación. Verifique su conexión a internet.");
      };
      
      // Establecer la URL con un pequeño retraso para mejor UX
      setTimeout(function() {
        iframe.src = urlReal;
      }, 500);
    }
    
    // Función para mostrar errores
    function mostrarError(mensaje) {
      var contenedor = document.getElementById('contenedor');
      contenedor.innerHTML = `
        <div class="error">
          <h3>Error</h3>
          <p>${mensaje}</p>
          <button class="btn-reintentar" onclick="reintentar()">Reintentar</button>
        </div>
      `;
    }
    
    // Función para reintentar
    function reintentar() {
      location.reload();
    }
    
    // Cargar cuando la página esté lista
    window.onload = function() {
      console.log("Iniciando carga del dashboard...");
      cargarDashboard();
    };
    
    // También intentar cargar si hay un retraso en la red
    window.addEventListener('DOMContentLoaded', function() {
      if (!window.onload.called) {
        setTimeout(cargarDashboard, 1000);
      }
    });
  </script>

</body>
</html>
