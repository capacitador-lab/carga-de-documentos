<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Sistema de Documentos RODICON</title>
  <style>
    body, html { margin: 0; padding: 0; width: 100%; height: 100%; overflow: hidden; font-family: Arial, sans-serif; }
    iframe { border: none; width: 100%; height: 100%; }
    .loader { position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); text-align: center; }
    .spinner { border: 4px solid #f3f3f3; border-top: 4px solid #3498db; border-radius: 50%; width: 40px; height: 40px; animation: spin 2s linear infinite; margin: 0 auto 15px; }
    @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    .error { display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: white; padding: 30px; border-radius: 10px; box-shadow: 0 5px 15px rgba(0,0,0,0.2); text-align: center; z-index: 1000; max-width: 400px; }
  </style>
</head>
<body>

  <div class="loader" id="loader">
    <div class="spinner"></div>
    <p>Iniciando sistema...</p>
  </div>

  <div class="error" id="error">
    <h3 style="color: #e74c3c; margin-bottom: 15px;">⚠️ Error</h3>
    <p id="errMsg" style="margin-bottom: 20px;">No se puede cargar la aplicación</p>
    <button onclick="reiniciar()" style="background: #3498db; color: white; border: none; padding: 10px 25px; border-radius: 5px; cursor: pointer;">Reintentar</button>
  </div>

  <iframe id="appFrame" style="display: none;" sandbox="allow-scripts allow-same-origin allow-forms allow-popups allow-modals" allow="camera"></iframe>

  <script>
    // OFUSCACIÓN AVANZADA: Dividir la URL en partes
    var parte1 = "aHR0cHM6Ly9z";
    var parte2 = "Y3JpcHQuZ29vZ2xl";
    var parte3 = "LmNvbS9tYWNyb3M";
    var parte4 = "vcy9BS2Z5Y2J6d0c";
    var parte5 = "2bV91d0k5ZnktQVJC";
    var parte6 = "bWR3YzRpT0Q0U0F1";
    var parte7 = "bjl1MmRmUTlpVGhidX";
    var parte8 = "BGajlyVnlsMjZvMGk5";
    var parte9 = "Y2N2OVJLeGhteCgvZX";
    var parte10 = "hlYw==";

    // Función para reconstruir la URL
    function obtenerURL() {
      try {
        // Juntar todas las partes
        var base64Completo = parte1 + parte2 + parte3 + parte4 + parte5 + 
                           parte6 + parte7 + parte8 + parte9 + parte10;
        
        // Limpiar
        base64Completo = base64Completo.replace(/\s/g, '');
        
        // Decodificar
        var url = atob(base64Completo);
        
        // Validar
        if (!url.includes('google.com') || !url.includes('/macros/')) {
          throw new Error('URL inválida');
        }
        
        return url;
      } catch (e) {
        console.error('Error obteniendo URL:', e);
        return null;
      }
    }

    // Cargar aplicación
    function cargarApp() {
      var url = obtenerURL();
      
      if (!url) {
        mostrarError('Error de configuración del sistema');
        return;
      }
      
      var iframe = document.getElementById('appFrame');
      var loader = document.getElementById('loader');
      var error = document.getElementById('error');
      
      // Configurar eventos
      iframe.onload = function() {
        console.log('✅ Aplicación cargada');
        loader.style.display = 'none';
        error.style.display = 'none';
        iframe.style.display = 'block';
      };
      
      iframe.onerror = function() {
        mostrarError('Error al conectar con el servidor. Verifica tu conexión.');
      };
      
      // Asignar URL
      iframe.src = url;
      
      // Timeout
      setTimeout(function() {
        if (loader.style.display !== 'none') {
          mostrarError('Tiempo de espera agotado. Intenta nuevamente.');
        }
      }, 30000);
    }
    
    function mostrarError(mensaje) {
      document.getElementById('loader').style.display = 'none';
      document.getElementById('errMsg').textContent = mensaje;
      document.getElementById('error').style.display = 'block';
    }
    
    function reiniciar() {
      document.getElementById('error').style.display = 'none';
      document.getElementById('loader').style.display = 'block';
      setTimeout(cargarApp, 500);
    }
    
    // Iniciar
    window.addEventListener('DOMContentLoaded', cargarApp);
    
    // Fallback
    if (document.readyState === 'complete') {
      cargarApp();
    }
  </script>

</body>
</html>
